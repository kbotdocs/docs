---
title: API2로 마이그레이션
category: 자습서
---

<Section>
  해당 문서는 레거시 API에서 API2로 마이그레이션하는 방법을 학습하기 위한 자습서입니다. 레거시 API와 API2의 공통점과 차이점을 이해하고, API2로의 마이그레이션을 위한 기본적인 지식을 습득합니다.
  API2의 주요 기능과 사용법을 익히고, 레거시 API에서 API2로의 전환을 원활하게 진행할 수 있도록 돕습니다.
</Section>
<Section>
  ## API2로 마이그레이션해야 하는 이유

  레거시 API에서 API2로 마이그레이션해야 하는 이유는 무엇일까요? 레거시 API는 구현된지 오래된 구식 API입니다. 
  메신저봇R에서는 코드의 유지보수를 어렵게 하고 확장성과 사용성이 충돌하는 등의 이유로 [레거시 API의 단계적 축소를 예고했습니다](https://messengerbotteam.github.io/posts/sunset-legacy-api.html).
  API2는 이러한 문제를 해결하기 위해 설계된 새로운 API로, 더 나은 가독성과 유지보수 경험, 그리고 확장성을 제공합니다. API2의 장점은 다음과 같습니다:

  <Section>
    ### 가독성 향상

    레거시 API는 메시지를 받을 때마다 [response 이벤트 리스너](/reference/legacy/EventListener/response)를 호출하는 구조입니다. 
    response 이벤트 리스너는 발신자의 이름, 메시지 내용, 메시지 전송 함수 등 감지한 메시지를 처리하기 위해 필요한 몇몇 데이터와 함수를 여러 개의 매개변수로 전달합니다.

    ~~~js
    function response(room, msg, sender, isGroupChat, replier, imageDB, packageName, isMention, logId, channelId, userHash) {
      // 메시지 처리 로직
    }
    ~~~

    이러한 매개변수 구조는 각 매개변수의 역할이 매개변수의 순서에 의존하게 되어 해당 이벤트 리스너를 작성하는데 어려움이 따릅니다. 

    반면, API2는 메시지를 받을 때마다 [message 이벤트](/reference/api2/Event/message)가 발생됩니다. 이 이벤트는 레거시 API와 달리 메시지를 처리하기 위한 데이터 및 함수들을 하나의 객체로 관리합니다.

    ~~~js
    const bot = BotManager.getCurrentBot();

    function onMessage(msg) {
      // msg.room: 메시지가 전송된 방의 이름
      // msg.content: 메시지 내용
      // msg.reply: 메시지를 전송하는 함수
      // ...
    }
    bot.addEventListener(Event.MESSAGE, onMessage);
    ~~~

    이러한 구조는 일렬로 나열된 매개변수에 비해 소스코드의 가독성을 높이고, 각 데이터의 역할을 명확하게 구분할 수 있습니다.
  </Section>
  <Section>
    ### 유지보수 경험 향상

    레거시 API는 메시지 감지, 컴파일 요청 등의 이벤트에 대한 리스너가 1개로 고정되어 있습니다. 이는 특정 이벤트에 대한 처리를 위한 많은 코드를 하나의 리스너에 작성해야 함을 의미합니다.
    예를 들어, 메시지 감지 이벤트를 처리하기 위해선 `response` 이벤트 리스너를, 컴파일 요청 이벤트를 처리하기 위해선 `onStartCompile` 이벤트 리스너를 사용해야만 합니다.

    반면, API2는 고정된 이벤트 리스너가 존재하지 않습니다. 대신, 프로그래머가 직접 특정 이벤트에 대한 리스너를 등록 및 삭제할 수 있습니다.

    ~~~js
    const bot = BotManager.getCurrentBot();

    function initMessageProcessingState(msg) {
      // ...
    }

    function onMessage(msg) {
      // ...
    }

    function messageDidSent(msg) {
      // ...
    }

    // 각 리스너를 등록
    bot.addEventListener(Event.MESSAGE, initMessageProcessingState);
    bot.addEventListener(Event.MESSAGE, onMessage);
    bot.addEventListener(Event.MESSAGE, messageDidSent);
    ~~~
  </Section>
</Section>